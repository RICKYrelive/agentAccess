# enhance-conversation-tool-visibility

## Summary

增强最近对话和聊天界面的工具/服务可视化显示，让用户能够：
1. 在对话列表中快速识别每个对话使用的 agent、MCP 工具、系统插件和知识库
2. 在聊天消息中查看工具调用过程（agent 调用、MCP 工具调用、插件执行）
3. 在默认演示对话中展示真实的工具使用场景

## Why

当前问题：
1. **对话信息不足**：侧边栏的最近对话只显示标题，无法看出配置了哪些工具和服务
2. **工具调用不可见**：聊天界面只显示文本消息，看不到背后的 agent 调用、工具使用过程
3. **演示对话不真实**：默认的演示对话只有纯文本对话，没有展示系统的实际能力

用户价值：
- 快速识别对话用途（通过工具标签）
- 了解 AI 响应是如何生成的（工具调用过程）
- 发现和探索系统功能（通过演示对话）

## What Changes

### 1. 对话标题增强显示

**位置**：侧边栏最近对话列表、聊天界面顶部

**显示内容**：
- Agent 标签（绿色）
- MCP 工具标签（蓝色）
- 系统插件标签（紫色）
- 知识库标签（橙色）

### 2. 消息工具调用显示

**位置**：聊天消息内容中

**显示内容**：
- Agent 调用提示框
- MCP 工具调用提示框
- 系统插件执行提示框（代码执行沙箱、浏览器沙箱）
- 知识库检索提示框

**视觉设计**：
- 不同类型工具使用不同颜色和图标
- 显示状态：执行中、完成、失败
- 可展开/折叠查看详细信息

### 3. 优化默认演示对话

**改动**：为 6 个默认对话添加真实的工具使用过程

1. **帮我生成一个PPT** - 使用写作助手 agent
2. **给我设置一个明天8点的会议提醒** - 使用日历插件
3. **写一封产品介绍邮件** - 使用写作助手 agent
4. **分析这个数据报表** - 使用数据分析 agent + 代码执行沙箱
5. **翻译这段文字到英文** - 使用翻译 MCP 服务
6. **搜索文档并总结** - 使用知识库检索

## Affected Components

### Core
- `ChatConversation` 类型 - 扩展 settings 字段
- `ChatMessage` 类型 - 添加 toolCalls 字段
- 新增 `ToolCall` 类型定义
- 新增 `SystemPlugin` 类型定义

### Frontend
- `SidebarNavigation.vue` - 对话列表显示工具标签
- `ChatInterface.vue` - 对话标题和消息中显示工具调用
- `ContentArea.vue` - 工具选择面板
- `chat.ts` store - 演示对话数据更新

### New Components
- `ToolCallIndicator.vue` - 工具调用提示框组件
- `ConversationTags.vue` - 对话工具标签组件

## Dependencies

- 依赖现有的 `AgentStore`、`KnowledgeBaseStore`、MCP 服务定义
- 依赖现有的对话数据结构
- 无外部依赖

## Migration Notes

1. **数据迁移**：现有对话的 settings 可能需要迁移以支持新的字段
2. **向后兼容**：没有 toolCalls 的消息正常显示，不影响现有功能
3. **演示对话刷新**：用户首次刷新页面后会看到更新的演示对话

## Success Criteria

1. 对话列表显示彩色标签，不同类型颜色区分明显
2. 聊天消息中工具调用提示框清晰易读
3. 演示对话展示真实的工具使用场景
4. 所有改动不影响现有对话的正常使用
